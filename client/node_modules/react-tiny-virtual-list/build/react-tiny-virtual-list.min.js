!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],e):e(t.VirtualList={},t.React,t.PropTypes)}(this,function(t,e,o){"use strict";function i(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}function r(t,e){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&(o[i[r]]=t[i[r]]);return o}var n,s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},a=function(){return(a=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)};!function(t){t.AUTO="auto",t.START="start",t.CENTER="center",t.END="end"}(n||(n={})),function(t){t.HORIZONTAL="horizontal",t.VERTICAL="vertical"}(t.ScrollDirection||(t.ScrollDirection={}));var l;!function(t){t.OBSERVED="observed",t.REQUESTED="requested"}(l||(l={}));var f,c,d,u=(f={},f[t.ScrollDirection.VERTICAL]="scrollTop",f[t.ScrollDirection.HORIZONTAL]="scrollLeft",f),h=(c={},c[t.ScrollDirection.VERTICAL]="height",c[t.ScrollDirection.HORIZONTAL]="width",c),p=(d={},d[t.ScrollDirection.VERTICAL]="top",d[t.ScrollDirection.HORIZONTAL]="left",d),m=function(){function t(t){var e=t.itemCount,o=t.itemSizeGetter,i=t.estimatedItemSize;this.itemSizeGetter=o,this.itemCount=e,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return t.prototype.updateConfig=function(t){var e=t.itemCount,o=t.itemSizeGetter,i=t.estimatedItemSize;null!=e&&(this.itemCount=e),null!=i&&(this.estimatedItemSize=i),null!=o&&(this.itemSizeGetter=o)},t.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},t.prototype.getSizeAndPositionForIndex=function(t){if(t<0||t>=this.itemCount)throw Error("Requested index "+t+" is outside of range 0.."+this.itemCount);if(t>this.lastMeasuredIndex){for(var e=this.getSizeAndPositionOfLastMeasuredItem(),o=e.offset+e.size,i=this.lastMeasuredIndex+1;i<=t;i++){var r=this.itemSizeGetter(i);if(null==r||isNaN(r))throw Error("Invalid size returned for index "+i+" of value "+r);this.itemSizeAndPositionData[i]={offset:o,size:r},o+=r}this.lastMeasuredIndex=t}return this.itemSizeAndPositionData[t]},t.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},t.prototype.getTotalSize=function(){var t=this.getSizeAndPositionOfLastMeasuredItem();return t.offset+t.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},t.prototype.getUpdatedOffsetForIndex=function(t){var e=t.align,o=void 0===e?n.START:e,i=t.containerSize,r=t.currentOffset,s=t.targetIndex;if(i<=0)return 0;var a,l=this.getSizeAndPositionForIndex(s),f=l.offset,c=f-i+l.size;switch(o){case n.END:a=c;break;case n.CENTER:a=f-(i-l.size)/2;break;case n.START:a=f;break;default:a=Math.max(c,Math.min(f,r))}var d=this.getTotalSize();return Math.max(0,Math.min(d-i,a))},t.prototype.getVisibleRange=function(t){var e=t.containerSize,o=t.offset,i=t.overscanCount;if(0===this.getTotalSize())return{};var r=o+e,n=this.findNearestItem(o);if(void 0===n)throw Error("Invalid offset "+o+" specified");var s=this.getSizeAndPositionForIndex(n);o=s.offset+s.size;for(var a=n;o<r&&a<this.itemCount-1;)a++,o+=this.getSizeAndPositionForIndex(a).size;return i&&(n=Math.max(0,n-i),a=Math.min(a+i,this.itemCount-1)),{start:n,stop:a}},t.prototype.resetItem=function(t){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,t-1)},t.prototype.findNearestItem=function(t){if(isNaN(t))throw Error("Invalid offset "+t+" specified");t=Math.max(0,t);var e=this.getSizeAndPositionOfLastMeasuredItem(),o=Math.max(0,this.lastMeasuredIndex);return e.offset>=t?this.binarySearch({high:o,low:0,offset:t}):this.exponentialSearch({index:o,offset:t})},t.prototype.binarySearch=function(t){for(var e=t.low,o=t.high,i=t.offset,r=0,n=0;e<=o;){if(r=e+Math.floor((o-e)/2),(n=this.getSizeAndPositionForIndex(r).offset)===i)return r;n<i?e=r+1:n>i&&(o=r-1)}return e>0?e-1:0},t.prototype.exponentialSearch=function(t){for(var e=t.index,o=t.offset,i=1;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<o;)e+=i,i*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:o})},t}(),S={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},I={position:"relative",width:"100%",minHeight:"100%"},g={position:"absolute",top:0,left:0,width:"100%"},z=function(s){function f(){var t=null!==s&&s.apply(this,arguments)||this;return t.itemSizeGetter=function(e){return function(o){return t.getSize(o,e)}},t.sizeAndPositionManager=new m({itemCount:t.props.itemCount,itemSizeGetter:t.itemSizeGetter(t.props.itemSize),estimatedItemSize:t.getEstimatedItemSize()}),t.state={offset:t.props.scrollOffset||null!=t.props.scrollToIndex&&t.getOffsetForIndex(t.props.scrollToIndex)||0,scrollChangeReason:l.REQUESTED},t.styleCache={},t.getRef=function(e){t.rootNode=e},t.handleScroll=function(e){var o=t.props.onScroll,i=t.getNodeOffset();i<0||t.state.offset===i||e.target!==t.rootNode||(t.setState({offset:i,scrollChangeReason:l.OBSERVED}),"function"==typeof o&&o(i,e))},t}return i(f,s),f.prototype.componentDidMount=function(){var t=this.props,e=t.scrollOffset,o=t.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=e?this.scrollTo(e):null!=o&&this.scrollTo(this.getOffsetForIndex(o))},f.prototype.componentWillReceiveProps=function(t){var e=this.props,o=e.estimatedItemSize,i=e.itemCount,r=e.itemSize,n=e.scrollOffset,s=e.scrollToAlignment,a=e.scrollToIndex,f=t.scrollToIndex!==a||t.scrollToAlignment!==s,c=t.itemCount!==i||t.itemSize!==r||t.estimatedItemSize!==o;t.itemSize!==r&&this.sizeAndPositionManager.updateConfig({itemSizeGetter:this.itemSizeGetter(t.itemSize)}),t.itemCount===i&&t.estimatedItemSize===o||this.sizeAndPositionManager.updateConfig({itemCount:t.itemCount,estimatedItemSize:this.getEstimatedItemSize(t)}),c&&this.recomputeSizes(),t.scrollOffset!==n?this.setState({offset:t.scrollOffset||0,scrollChangeReason:l.REQUESTED}):"number"==typeof t.scrollToIndex&&(f||c)&&this.setState({offset:this.getOffsetForIndex(t.scrollToIndex,t.scrollToAlignment,t.itemCount),scrollChangeReason:l.REQUESTED})},f.prototype.componentDidUpdate=function(t,e){var o=this.state,i=o.offset,r=o.scrollChangeReason;e.offset!==i&&r===l.REQUESTED&&this.scrollTo(i)},f.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},f.prototype.scrollTo=function(e){var o=this.props.scrollDirection,i=void 0===o?t.ScrollDirection.VERTICAL:o;this.rootNode[u[i]]=e},f.prototype.getOffsetForIndex=function(e,o,i){void 0===o&&(o=this.props.scrollToAlignment),void 0===i&&(i=this.props.itemCount);var r=this.props.scrollDirection,n=void 0===r?t.ScrollDirection.VERTICAL:r;return(e<0||e>=i)&&(e=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:o,containerSize:this.props[h[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},f.prototype.recomputeSizes=function(t){void 0===t&&(t=0),this.styleCache={},this.sizeAndPositionManager.resetItem(t)},f.prototype.render=function(){var o=this.props,i=(o.estimatedItemSize,o.height),n=o.overscanCount,s=void 0===n?3:n,l=o.renderItem,f=(o.itemCount,o.itemSize,o.onItemsRendered),c=(o.onScroll,o.scrollDirection),d=void 0===c?t.ScrollDirection.VERTICAL:c,u=(o.scrollOffset,o.scrollToIndex,o.scrollToAlignment,o.style),p=o.width,m=r(o,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","style","width"]),g=this.state.offset,z=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[h[d]]||0,offset:g,overscanCount:s}),v=z.start,y=z.stop,T=[],O=a({},S,u,{height:i,width:p}),C=a({},I,(A={},A[h[d]]=this.sizeAndPositionManager.getTotalSize(),A));if(void 0!==v&&void 0!==y){for(var x=v;x<=y;x++)T.push(l({index:x,style:this.getStyle(x)}));"function"==typeof f&&f({startIndex:v,stopIndex:y})}return e.createElement("div",a({ref:this.getRef},m,{style:O}),e.createElement("div",{style:C},T));var A},f.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,o=void 0===e?t.ScrollDirection.VERTICAL:e;return this.rootNode[u[o]]},f.prototype.getEstimatedItemSize=function(t){return void 0===t&&(t=this.props),t.estimatedItemSize||"number"==typeof t.itemSize&&t.itemSize||50},f.prototype.getSize=function(t,e){return"function"==typeof e?e(t):Array.isArray(e)?e[t]:e},f.prototype.getStyle=function(e){var o=this.styleCache[e];if(o)return o;var i=this.props.scrollDirection,r=void 0===i?t.ScrollDirection.VERTICAL:i,n=this.sizeAndPositionManager.getSizeAndPositionForIndex(e),s=n.size,l=n.offset;return this.styleCache[e]=a({},g,(f={},f[h[r]]=s,f[p[r]]=l,f));var f},f.defaultProps={overscanCount:3,scrollDirection:t.ScrollDirection.VERTICAL,width:"100%"},f.propTypes={estimatedItemSize:o.number,height:o.oneOfType([o.number,o.string]).isRequired,itemCount:o.number.isRequired,itemSize:o.oneOfType([o.number,o.array,o.func]).isRequired,onScroll:o.func,onItemsRendered:o.func,overscanCount:o.number,renderItem:o.func.isRequired,scrollOffset:o.number,scrollToIndex:o.number,scrollToAlignment:o.oneOf([n.AUTO,n.START,n.CENTER,n.END]),scrollDirection:o.oneOf([t.ScrollDirection.HORIZONTAL,t.ScrollDirection.VERTICAL]),style:o.object,width:o.oneOfType([o.number,o.string])},f}(e.PureComponent);t.default=z,Object.defineProperty(t,"__esModule",{value:!0})});
